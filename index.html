<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FusionX</title>
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/337/337946.png" type="image/png">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/pdf-lib"></script>
  <style>
    :root {
      --bg: #f5f5f5;
      --text: #333;
      --highlight: #3498db;
      --card: rgba(255, 255, 255, 0.2);
      --light-gray: #ccc;
      --shadow: rgba(0, 0, 0, 0.1);
      --glass-blur: blur(10px);
    }
    body.dark {
      --bg: #1e1e1e;
      --text: #eee;
      --highlight: #9b59b6;
      --card: rgba(44, 44, 44, 0.3);
      --light-gray: #555;
      --shadow: rgba(255, 255, 255, 0.1);
      --glass-blur: blur(12px);
    }
    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
      padding: 0;
      background-color: var(--bg);
      color: var(--text);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      transition: background-color 0.4s ease;
    }
    .container {
      background-color: var(--card);
      border-radius: 20px;
      padding: 25px;
      max-width: 600px;
      width: 100%;
      box-shadow: 0 10px 30px var(--shadow);
      backdrop-filter: var(--glass-blur);
      -webkit-backdrop-filter: var(--glass-blur);
      animation: fadeIn 0.6s ease-in-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    h1 { display: flex; align-items: center; gap: 10px; font-size: 1.6rem; font-weight: bold; }
    h1 img { width: 28px; height: 28px; }
    .controls, .options {
      margin-top: 15px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: space-between;
    }
    .upload {
      margin-top: 15px;
      padding: 20px;
      border: 2px dashed var(--highlight);
      text-align: center;
      border-radius: 10px;
      background-color: rgba(240, 248, 255, 0.2);
      cursor: pointer;
      transition: background 0.3s ease, transform 0.3s ease;
    }
    .upload:hover {
      background-color: rgba(240, 248, 255, 0.3);
      transform: scale(1.02);
    }
    .preview {
      margin-top: 15px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .item {
      display: flex;
      align-items: center;
      gap: 10px;
      background: rgba(255,255,255,0.1);
      border: 1px solid var(--light-gray);
      border-radius: 8px;
      padding: 10px;
      cursor: grab;
      flex-wrap: wrap;
    }
    .thumb {
      width: 40px;
      height: 40px;
      display: flex;
      justify-content: center;
      align-items: center;
      background: #ddd;
      border-radius: 6px;
      overflow: hidden;
    }
    .thumb img {
      max-width: 100%;
      max-height: 100%;
    }
    .filename {
      flex-grow: 1;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
      border: none;
      background: transparent;
      color: inherit;
      font-weight: 500;
    }
    .rotate-btn, .delete-btn {
      background: none;
      border: none;
      font-size: 1.2em;
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    .rotate-btn:hover, .delete-btn:hover {
      color: var(--highlight);
      transform: scale(1.2);
    }
    .angle { font-size: 0.8em; color: #555; }
    .btn-group {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    .btn {
      background: #2ecc71;
      border: none;
      color: white;
      padding: 12px 20px;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
      max-width: 250px;
      transition: background 0.3s ease, transform 0.2s ease;
    }
    .btn:hover {
      background: #27ae60;
      transform: scale(1.05);
      box-shadow: 0 5px 15px rgba(46, 204, 113, 0.4);
    }
    input[type="text"]:focus {
      border-color: var(--highlight);
      box-shadow: 0 0 5px var(--highlight);
      outline: none;
      transition: all 0.2s ease-in-out;
    }
	#themeToggle {
      padding: 10px 16px;
      background: linear-gradient(to right, #9b59b6, #3498db);
      border: none;
      border-radius: 8px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    #themeToggle:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
    }
    iframe {
      width: 100%;
      height: 400px;
      border: 1px solid #ccc;
      margin-top: 15px;
      border-radius: 8px;
      background: white;
    }
    .footer {
      margin-top: 20px;
      font-size: 0.8em;
      color: #888;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1><img src="https://cdn-icons-png.flaticon.com/512/337/337946.png" alt="icon">FusionX</h1>
    <div class="options">
      <label><input type="checkbox" id="fitA4"> A4 auto</label>
      <button id="themeToggle" onclick="toggleTheme()">üåô Mode sombre</button>
    </div>
    <div class="controls">
      <input type="text" id="filename" placeholder="Nom du fichier (ex: fusion.pdf)" style="flex:1;padding:8px;border-radius:6px;border:1px solid #ccc;">
      <button class="btn" onclick="clearAll()">üóëÔ∏è Tout effacer</button>
    </div>
    <div class="upload" id="dropzone" onclick="document.getElementById('upload').click()">
      Glisser-d√©poser ou cliquer pour s√©lectionner vos fichiers
      <input type="file" id="upload" multiple accept=".pdf,image/*" style="display: none">
    </div>
    <div class="preview" id="previewList"></div>
    <div class="btn-group">
      <button class="btn" onclick="generatePDF(true)">üîé Visualiser</button>
      <button class="btn" onclick="generatePDF(false)">üìÑ G√©n√©rer le PDF</button>
    </div>
    <iframe id="previewFrame" style="display:none;"></iframe>
    <div class="footer">D√©velopp√© avec ‚ù§Ô∏è par Jeff Longele ‚Äî vos fichiers ne sont jamais enregistr√©s.</div>
  </div>
<script>
  const dropzone = document.getElementById("dropzone");
  const fileInput = document.getElementById("upload");
  const previewList = document.getElementById("previewList");
  const themeToggle = document.getElementById("themeToggle");
  let filesData = [];
  let draggedIndex = null;

  document.addEventListener("DOMContentLoaded", () => updateThemeButton());

  function toggleTheme() {
    document.body.classList.toggle("dark");
    updateThemeButton();
  }

  function updateThemeButton() {
    const isDark = document.body.classList.contains("dark");
    themeToggle.textContent = isDark ? "‚òÄÔ∏è Mode clair" : "üåô Mode sombre";
  }

  dropzone.addEventListener("dragover", (e) => {
    e.preventDefault();
    dropzone.classList.add("dragover");
  });
  dropzone.addEventListener("dragleave", () => {
    dropzone.classList.remove("dragover");
  });
  dropzone.addEventListener("drop", (e) => {
    e.preventDefault();
    dropzone.classList.remove("dragover");
    handleFiles(e.dataTransfer.files);
  });
  fileInput.addEventListener("change", (e) => handleFiles(e.target.files));

  function handleFiles(fileList) {
    for (const file of fileList) filesData.push({ file, rotation: 0 });
    renderList();
  }

  function renderList() {
    previewList.innerHTML = "";
    filesData.forEach((entry, index) => {
      const div = document.createElement("div");
      div.className = "item";
      div.setAttribute("draggable", true);
      div.dataset.index = index;
      div.addEventListener("dragstart", () => draggedIndex = index);
      div.addEventListener("dragover", e => e.preventDefault());
      div.addEventListener("drop", () => {
        const item = filesData.splice(draggedIndex, 1)[0];
        filesData.splice(index, 0, item);
        renderList();
        generatePDF(true);
      });

      const thumb = document.createElement("div");
      thumb.className = "thumb";
      if (entry.file.type.startsWith("image/")) {
        const img = document.createElement("img");
        img.src = URL.createObjectURL(entry.file);
        thumb.appendChild(img);
      } else thumb.textContent = "üìÑ";

      const name = document.createElement("input");
      name.className = "filename";
      name.value = entry.file.name;
      name.addEventListener("change", () => entry.file.name = name.value);

      const rotateBtn = document.createElement("button");
      rotateBtn.className = "rotate-btn";
      rotateBtn.innerHTML = `üîÑ <span class="angle">${entry.rotation}¬∞</span>`;
      rotateBtn.onclick = () => {
        entry.rotation = (entry.rotation + 90) % 360;
        renderList();
        generatePDF(true);
      };

      const delBtn = document.createElement("button");
      delBtn.className = "delete-btn";
      delBtn.textContent = "‚ùå";
      delBtn.onclick = () => {
        filesData.splice(index, 1);
        renderList();
        document.getElementById("previewFrame").style.display = "none";
      };

      div.append(thumb, name, rotateBtn, delBtn);
      previewList.appendChild(div);
    });
  }

  function clearAll() {
    filesData = [];
    renderList();
    document.getElementById("previewFrame").style.display = "none";
  }

  async function generatePDF(isPreview) {
    if (filesData.length === 0) return alert("Ajoutez des fichiers");
    const { PDFDocument, degrees } = PDFLib;
    const pdfDoc = await PDFDocument.create();
    const fitToA4 = document.getElementById("fitA4").checked;

    for (const entry of filesData) {
      const file = entry.file;
      const buffer = await file.arrayBuffer();
      if (file.type === "application/pdf") {
        const pdf = await PDFDocument.load(buffer);
        const pages = await pdfDoc.copyPages(pdf, pdf.getPageIndices());
        pages.forEach(p => {
          if (entry.rotation % 360 !== 0) p.setRotation(degrees(entry.rotation));
          pdfDoc.addPage(p);
        });
      } else if (file.type.startsWith("image/")) {
        const embed = file.type.includes("png") ? await pdfDoc.embedPng(buffer) : await pdfDoc.embedJpg(buffer);
        const dims = fitToA4 ? [595.28, 841.89] : [embed.width, embed.height];
        const page = pdfDoc.addPage(dims);
        const scale = fitToA4 ? Math.min(dims[0] / embed.width, dims[1] / embed.height) : 1;
        const x = (dims[0] - embed.width * scale) / 2;
        const y = (dims[1] - embed.height * scale) / 2;
        page.drawImage(embed, {
          x,
          y,
          width: embed.width * scale,
          height: embed.height * scale,
          rotate: degrees(entry.rotation)
        });
      }
    }

    const pdfBytes = await pdfDoc.save();
    const blob = new Blob([pdfBytes], { type: "application/pdf" });
    if (isPreview) {
      const url = URL.createObjectURL(blob);
      const frame = document.getElementById("previewFrame");
      frame.style.display = "block";
      frame.src = url;
    } else {
      const name = document.getElementById("filename").value.trim() || "FusionX.pdf";
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = name.endsWith(".pdf") ? name : name + ".pdf";
      a.click();
    }
  }
</script>
</body>
</html>
